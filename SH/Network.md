# Network

## 1. OSI 7계층

​	Open Systems Interconnection의 약자로 개방형 시스템이라는 뜻

![osi-7-layer](md-images/osi-7-layer.png)

* 각 계층은 하위 계층의 기능만을 이용하고, 상위 계층에게 기능을 제공한다.

* '[프로토콜](공통의 데이터 교환 방법 및 순서에 대해 정의한 의사소통 약속, 규약 혹은 규칙 체계를 말한다.) 스택' 혹은 '스택'은 이러한 계층들로 구성되는 프로토콜 시스템이 구현된 시스템을 가리키는데, 프로토콜 스택은 하드웨어나 소프트웨어 혹은 둘의 혼합으로 구현될 수 있다.

* 일반적으로 하위 계층들은 하드웨어로, 상위 계층들은 소프트웨어로 구현된다.

  

![osi-table](md-images/osi-table.PNG)

### 1. 물리 계층(Physical layer)

* 단말기기와 전송매체 사이의 인터페이스를 정의하고 상위 계층 엔티티 간의 비트 전송을 위한 기계적, 전기적, 기능적, 절차적인 수단을 제공하는 계층. 즉, 이진 데이터를 어떤 시그마로 만들고, 신호를 주고 받기 위한 전기적, 전파적 특성을 정의하는 계층

* 네트워크의 기본 네트워크 하드웨어 전송 기술을 이룬다.

* 전송 단위는 Bit이다.

* 물리 계층에서 가장 많이 고민하는 사항은 대역폭과 전송효율

* 단지 데이터를 전달만 할 뿐 이 데이터가 무엇인지, 어떤 에러가 있는지, 어떻게 보내는 것이 더 효과적인지는 전혀 관혀하지 않는다.

  

### 2. 데이터 링크 계층(Data link layer)

* 잡음이 없는 인접한 노드 간의 물리적인 회선을 상위 계층이 사용할 수 있도록 전송에러가 없는 통신 채널로 변화시키는 계층

* 포인트 투 포인트(Point to Point) 간 신뢰성있는 전송을 보장하기 위한 계층으로 [CRC](순환 중복 검사(Cyclic Redundancy Check) : 네트워크 등을 통하여 데이터를 전송할 때 전송된 데이터에 오류가 있는지를 확인하기 위한 체크값을 결정하는 방식 ) 기반의 오류 제어와 흐름 제어가 필요하다.

* 주소 값은 물리적으로 할당 받는데, 이는 네트워크 카드가 만들어질 때부터 [맥 주소(MAC address)]( 네트워크 세그먼트의 데이터 링크 계층에서 통신을 위한 네트워크 인터페이스에 할당된 고유 식별자)가 정해져 있다는 뜻이다.

* 데이터 전송 단위는 Frame이다.

  

### 3. 네트워크 계층(Network layer)

* [논리적인 주소](IP주소, IPX주소, 컴퓨터 이름 등)를 담당하고 패킷의 전달 경로를 결정하는 계층

* 다양한 길이의 데이터를 네트워크들을 통해 전달하고, 그 과정에서 전송 계층이 요구하는 서비스 품질(QoS)을 제공하기 위한 기능적, 절차적 수단을 제공

* [라우팅](단말기 혹은 컴퓨터가 어떤 네트워크에 접속되어 있을 때 송신하고자 하는 정보가 네트워크를 통해서 어떻게 상대방 수신측까지 전달되는가를 제어하는 일을 담당. 즉, 발신에서 착신까지의 패킷의 경로를 제어), 흐름 제어, 세그멘테이션(segmentation/desegmentation), 오류 제어, 인터네트워킹(Internetworking) 등을 수행

* 네트워크 관리자가 직접 주소(IP)를 할당하는 구조를 가지며, 계층적(hierarchical)이다.

* 데이터 전송 단위는 Datagram(Packet)이다.

  

### 4. 전송 계층(Transport layer)

* 양 끝단(End to end)의 사용자들이 투명하고 신뢰성 있는 데이터를 주고 받을 수 있도록 해주어, 상위 계층들이 데이터 전달의 유효성이나 효율성을 생각하지 않도록 해주는 계층

* 시퀀스 넘버 기반의 오류 제어 방식을 사용한다.

* 전송 계층은 특정 연결의 유효성을 제어하고, 일부 프로토콜은 상태 개념이 있고(stateful), 연결 기반(connection oriented)이다. (이는 전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것을 뜻한다.)

* 가장 잘 알려진 전송 계층의 예는 [TCP](전송 제어 프로토콜(Transmission Control Protocol))이다.

* 데이터 전송 단위는 Segment이다.

  

### 5. 세션 계층(Session layer)

* 양 끝단의 응용 프로그램 간의 연결을 성립하게 하고 연결이 안정되게 유관리하며 작업 완료 후 연결을 끊는 역할을 하는 계층. 즉, 데이터 교환과 에러 발생 시 복구를 담당

* TCP/IP 세션을 만들고 없애는 책임을 진다.

  

### 6. 표현 계층(Presentation layer)

* 코드 간의 번역을 담당하여 사용자 시스템에서 데이터의 형식상 차이를 하나의 통일된 형식으로 변환시켜 응용 계층의 부담을 덜어 주는 계층
* MIME 인코딩이나 암호화 등의 동작이 이 계층에서 이루어진다.



### 7. 응용 계층(Application layer)

* 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행하는 계층
* 일반적인 응용 서비스는 관련된 응용 프로세스들 사이의 전환을 제공한다.



### 계층을 나눈 이유?

통신이 일어나는 과정을 단계별로 파악하고 특정한 곳에 이상이 생기면 다른 단계를 건들지 않고 이상이 생긴 단계만 고칠 수 있게 하여 문제 해결을 용이하게 해준다.

즉, 상위 계층의 프로토콜이 제대로 동작하기 위해서는 하위의 모든 계층이 문제가 없어야 하기 때문에, 문제가 생긴 계층을 정확하게 파악할 수 있다.



## 2. TCP/IP의 개념

패킷 통신 방식의 인터넷 프로토콜인 IP (인터넷 프로토콜)와 전송 조절 프로토콜인 TCP (전송 제어 프로토콜)로 이루어져 있다. IP는 패킷 전달 여부를 보증하지 않고, 패킷을 보낸 순서와 받는 순서가 다를 수 있다.(unreliable datagram service) TCP는 IP 위에서 동작하는 프로토콜로, 데이터의 전달을 보증하고 보낸 순서대로 받게 해준다. HTTP, FTP, SMTP 등 TCP를 기반으로 한 많은 수의 애플리케이션 프로토콜들이 IP 위에서 동작하기 때문에, 묶어서 TCP/IP로 부르기도 한다. 즉, IP가 데이터의 배달을 처리한다면 TCP는 패킷을 추적 및 관리한다.



### 1. IP(Internet Protocol)

송신 호스트와 수신 호스트가 패킷 교환 네트워크(Packet Switching Network)에서 정보를 주고받는 데 사용하는 정보 위주의 규약(프로토콜)이며, OSI 네트워크 계층에서 호스트의 주소지정과 패킷 분할 및 조립 기능을 담당한다.

* IP의 정보는 [패킷](전송하고자 하는 데이터의 한 블록(Payload)과 주소지 정보(방신지 주소, 목적지 주소), 관리정보(Header, IPv6에서와 같이 네트워크가 패킷을 목적지까지 전달하는 데 필요한)로 구성된다. 각각의 패킷은 일정한 헤더가 필요하며 패킷은 적절한 크기로 나뉜다.) 혹은 데이터그램이라고 하는 덩어리로 나뉘어 전송된다. IP에서는 이전에 통신한 적 없는 호스트에 패킷을 보낼 때 경로 설정이 필요없다.

* IP는 비신뢰성(unreliability)과 비연결성(connectionlessness)이 특징이다. 비신뢰성은 흐름에 관여하지 않기 때문에 보낸 정보가 제대로 갔는지 보장하지 않는다는 뜻이다. 예를 들어 전송과정에서 패킷이 손상될 수도 있고, 같은 호스트에서 전송한 패킷의 순서가 뒤죽박죽이 될 수도 있고, 같은 패킷이 두 번 전송될 수도 있으며, 아예 패킷이 사라질 수도 있다. 패킷 전송과 정확한 순서를 보장하려면 TCP 프로토콜과 같은 IP의 상위 프로토콜을 이용해야 한다.

* IPv6 (Internet Protocol version 6)

  IPv4 프로토콜의 주소가 32비트라는 제한된 주소 공간 및 국가별로 할당된 주소가 거의 소진되고 있다는 한계점으로 인해 지속적인 인터넷 발전에 문제가 예상되어, 이에 대한 대안으로서 IPv6 프로토콜이 제안되었다.

  IPv6와 기존 IPv4 사이의 가장 큰 차이점은 바로 IP 주소의 길이가 128비트로 늘어났다는 점이다. 여러가지 새로운 기능을 제공하는 동시에 기존 IPv4와의 호환성을 최대로 하는 방향으로 설계되었다.

  

### 2. TCP(Transmission Control Protocol)

TCP는 연결된 컴퓨터에서 실행되는 프로그램 간에 일련의 [옥텟](8bit = byte)을 안정적으로, 순서대로, 에러없이 교환할 수 있게 한다. 네트워크의 정보 전달을 통제하는 프로토콜이자 인터넷을 이루는 핵심 프로토콜 중 하나이다.

![TCP](md-images/TCP.PNG) 

* 한 경로로 움직인다.

* TCP는 데이터 스트림으로부터 데이터를 받아 들여 이것을 청크 단위로 분할한 뒤 TCP 헤더를 덧붙여 TCP 세그먼트를 생성한다. TCP 세그먼트는 IP 데이터그램을 캡슐화하여 상대방과 주고 받게 된다.
* TCP의 작동은 크게 세 가지 흐름으로 구분한다.
  1. 연결 생성
  2. 자료 전송
  3. 연결 종료
* 연결형 서비스로 가상 회선 방식을 제공한다. 3-way handshaking을 통해 연결을 설정하고, 4-way handshaking을 통해 연결을 해제한다.
* 흐름제어
  * 데이터를 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지한다.
  * 송신하는 곳에서 감당이 안되게 많은 데이터를 빠르게 보내 수신하는 곳에서 문제가 일어나는 것을 막는다.
* 혼잡제어
  * 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 방지한다.
  * 정보의 소통량이 과다하면 패킷을 조금만 전송하여 혼잡 붕괴 현상이 일어나는 것을 막는다.
* UDP보다 속도가 느리다.
* 전이중(Full-Duplex), 점대점(Point to Point) 방식이다.
  * 전이중 : 전송이 양뱡항으로 동시에 일어날 수 있다.
  * 점대점 : 각 연결이 정호가히 2개의 종단점을 가지고 있다.

* 연속성보다 신뢰성있는 전송이 중요할 때에 사용된다.

  * Streaming 서비스에 불리하다.(손실된 경우 재전송 요청을 하므로)

   



## 3. UDP(User Datagram Protocol)

데이터를 [데이터그램](독립적인 관계를 지니는 패킷) 단위로 처리하는 프로토콜이다. TCP와 달리 UDP는 비연결형 프로토콜이기 때문에 연결을 위해 할당되는 논리적인 경로가 없다. 

![UDP](md-images/UDP.PNG)

* 각각의 패킷은 독립적인 관계를 지니고 데이터를 서로 다른 경로로 독립적으로 처리한다.

* 정보를 주고 받을 때 정보를 보내거나 받는다는 신호절차를 거치지 않는다.
* 신뢰성이 낮다.
* TCP보다 속도가 빠르다.
* 신뢰성보다는 연속성이 중요한 서비스에 사용된다.
  *  실시간 서비스(streaming)에 자주 사용

![TCP-UDP](md-images/TCP-UDP.PNG)



## 4. TCP와 UDP의 헤더 분석

### 1. TCP Header

![TCP-Header](md-images/TCP-Header.PNG)	

| 필드                       | 내용                                                         | 크기(bits) |
| -------------------------- | ------------------------------------------------------------ | ---------- |
| Source Port                | 출발지 포트번호를 표시. 응용 서비스에 따라 포트번호가 정해져 있는 것도 있지만, 대부분의 경우 처음 세그먼트를 전송하는 측에서 임의의 번호를 사용한다. | 16         |
| Destination Port           | 목적지 포트번호를 표시. 응용 서비스에 따라 포트번호가 정해져 있다. | 16         |
| Sequence Number            | 송신자가 지정하는 순서 번호                                  | 32         |
| Acknowledgment(ACK) Number | 수신 프로세스가 제대로 수신한 바이트의 수 응답 용            | 32         |
| Header Length(Data Offset) | TCP 헤더 길이를 4바이트 단위로 표시(최소 20, 최대 60 바이트) (3way-handshake 절차 협상에 사용) | 4          |
| Resv(Reserved)             | 나중을 위해 0으로 채워진 예약 필드                           | 6          |
| Flag Bit                   | SYN, ACK, FIN 등 제어 번호(아래 표 참고)                     | 6          |
| Window Size                | **수신 윈도우의 버퍼 크기** 지정(0이면 송신 중지). TCP 흐름제어를 위해 통신의 상대편에게 자신의 버퍼 여유용량 크기를 지속적으로 통보하는 기능을 함. | 16         |
| TCP Checksum               | 헤더와 데이터의 에러 확인 용도                               | 16         |
| Urgent Pointer(긴급 위치)  | 현재 순서 번호부터 표시된 바이트까지 긴급한 데이터임을 표시, URG 플래그 비트가 지정된 경우에만 유효 | 16         |
| Options                    | 추가 옵션 있을 경우 표시                                     | 0~40       |

* Sequence Number

  - TCP 각 세그먼트의 첫번째 바이트에 부여되는 번호 (바이트 단위로 구분되는 번호임). 초기 SYN = 1로 연결에 1byte를 소비하기 때문. 이후 SYN은 바이트 단위로 증가(ex) 100 byte 단위 => 첫번째 SYN = 1, 두번째 SYN =101, 세번째 SYN = 201, ...)
  - 32 비트이므로 최대 4기가 바이트 크기의 (2^32) 의송신, 즉 0~(2^32-1) 사이의 유한한 값을 가진다.
  - 데이터에 순서화된 일련번호를 붙여 수신 측에서는 중복된 자료를 폐기하고, 순서가 뒤바뀌어도 순서대로 재구성하는 것이 가능

* Acknowledgment Number

  * 상대방이 보낸 세그먼트를 잘 받았다는 것을 알려주기 위한 번호

  * 수신하기를 기대하는 다음 바이트 번호 = (마지막 수신 성공 번호 + 바이트 단위). 

    즉, ACK = SYN + byte 단위

* Flag Bit

  | 종류 | 내용                                                         |
  | ---- | ------------------------------------------------------------ |
  | URG  | 긴급 위치 필드 유효 여부 설정                                |
  | ACK  | 응답 유효 여부 설정. 최초의 SYN 패킷 이후 모든 패킷은 ACK 플래그 설정 필요. 데이터를 잘 받았으면 긍정 응답으로 ACK를 전송 |
  | PSH  | 수신측에 버퍼링된 데이터를 상위 계층에 즉시 전달할 때        |
  | RST  | 연결 리셋 응답 혹은 유효하지 않은 세그먼트 응답              |
  | SYN  | 연결 설정 요청. 양쪽이 보낸 최초 패킷에만 SYN 플래그 설정    |
  | FIN  | 연결 종료 의사 표시                                          |



### 2. UDP Header

![UDP-Header](md-images/UDP-Header.PNG)

| 필드                          | 내용                                                         | 크기(bits) |
| ----------------------------- | ------------------------------------------------------------ | ---------- |
| Source Port, Destination Port | 송수신 애플리케이션의 포트 번호                              | 16         |
| Length                        | 헤더와 데이터 포함 전체 길이                                 | 16         |
| Checksum                      | 헤더와 데이터의 에러 확인 용도. UDP는 에러 복구를 위한 필드가 불필요하기 때문에 TCP 헤더에 비해 간단 | 16         |

* 최대 데이터 크기

   – 65,507바이트 = 65,535 바이트 – udp 헤더 8바이트 – ip 헤더 20바이트